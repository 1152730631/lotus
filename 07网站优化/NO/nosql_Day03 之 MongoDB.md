# nosql_Day03 之 MongoDB

[TOC]

* nosql[not only sql] 非关系型数据库
    * 没有链表操作 
    * 没有sql语句操作 
    * key=>value 结构
 
* memcache redis 存储在内存中 
* redis 有数据持久化功能
* **mongoDB** 数据存储在硬盘文件中



* 关系型数据库
* mysql sqlservice oracle

![-w494](media/14969698086369/14969724470498.jpg)
  
* mysql  最初属于AB公司=>sun公司（java）=>oracle
       mariaDB mysql分支
* sqlsever  微软公司  sql2000 2005 
* oracle   oracle（甲骨文）  java   10g 11g
* DB2   IBM
* postgresql 加州伯克利大学  
* access  微软小型数据库  asp
* sqlite3  手机移动端存储数据使用

  
  
  
  
## MongoDB特点

![-w634](media/14969698086369/14969747683728.jpg)

* 存储性

单表存储PB级别
1KB= 1024B
1MB = 1024KB
1GB = 1024MB
1TB = 1024GB
1PB = 1024TB
1EB （Exabyte 百亿亿字节 艾字节）=1024PB，
1ZB （Zettabyte 十万亿亿字节 泽字节）= 1024EB，
1YB （Yottabyte 一亿亿亿字节 尧字节）= 1024ZB，
1BB （Brontobyte 一千亿亿亿字节）= 1024YB。



* 效率性

![-w511](media/14969698086369/14970068148678.jpg)


## mongoDB安装

### 使用 brew 安装
`sudo brew install mongodb`

### 启动
* 启动服务器端 
* 注意启动 mongod 要加 sudo权限

`sudo mongod`

* 启动客户端

`./mongo`

* 配置文件

* `/usr/local/etc/mongod.conf`

![-w453](media/14969698086369/14969768716923.jpg)

****

## mongoDB操作
### 结构
![-w519](media/14969698086369/14970068433855.jpg)

* **开启客户端**

![-w408](media/14969698086369/14969786833459.jpg)

![-w420](media/14969698086369/14969785340733.jpg)

****

* ① `help`命令

![-w670](media/14969698086369/14969787496971.jpg)

****

* ② `show logs` 

![-w440](media/14969698086369/14969789922394.jpg)

****

* ③ `show log global`

![-w514](media/14969698086369/14969790559565.jpg)

****

* ④ `use`命令 如果数据库存在就切换 如果不存在就创建

![-w586](media/14969698086369/14969792820857.jpg)

****

* ⑤ 创建数据库 `use`

****

* ⑥ 查看数据库帮助 `db.help()`

****

* ⑦ 计算编写js方法代码

![-w501](media/14969698086369/14969794352140.jpg)

![-w405](media/14969698086369/14969794915233.jpg)

![-w324](media/14969698086369/14969796333266.jpg)

****


## 添加数据
### 普通数据添加
`db.collection.insert(document)`
`db.goods.insert({})`

![-w462](media/14969698086369/14969798074087.jpg)

* `db.goods.insert({name:'z',price:100,weight:135,number:35})`

![-w502](media/14969698086369/14969799529870.jpg)

* **document 数据类似是一种 BSON 类型**

****

### 多维数据添加

* `db.goods.insert({name:'xiaomi5',price:1999,weight:156,namber:45,area:{province:'bj',city:'bj'}})`

![](media/14969698086369/14969802797331.jpg)

* 全部查询用 `find()`方法

![-w709](media/14969698086369/14969803677230.jpg)

****

### 添加数组信息

* `db.goods.insert({name:'xmMax',price:2000,weight:180,number:100,area:{province:'bj',city:'bj'},color:['red']})`

![-w905](media/14969698086369/14969807014768.jpg)
 
****


##查询数据
* **语法:**
* `db.collection.find([查询条件]，[筛选])`  返回所有符合条件的结果
* `db.collection.findOne([查询条件],[筛选])`  返回所有符合条件的结果第一条

****

### 笼统查询

![-w969](media/14969698086369/14969903664063.jpg)

****

### 条件限制查询
* `db.goods.find({})`
* `db.goods.find({name:'xiaomi5'})`

![-w921](media/14969698086369/14969904822904.jpg)

****

### 范围条件查询
* `db.goods.find({price:{'':value}})`
* `db.goods.find({price:{'$gt':1999}})`

![-w762](media/14969698086369/14969905846451.jpg)

![-w747](media/14969698086369/14969906807775.jpg)


****

### 多个查询条件 AND操作
* `db.goods.find({},{})`


![-w790](media/14969698086369/14969907019032.jpg)

![-w596](media/14969698086369/14969907977468.jpg)

****

### 满足其中一条查询 $or查询
* `db.goods.find({'$or':[{},{}])`


![-w777](media/14969698086369/14969908560919.jpg)

![-w627](media/14969698086369/14969914186827.jpg)


****

### 多维字段查询

![-w652](media/14969698086369/14969913839570.jpg)

****

### 数组查询条件查询

![-w947](media/14969698086369/14969918448037.jpg)


* `db.goods.find({key:{'$all':['value1','value2']}})`

![-w966](media/14969698086369/14969918368220.jpg)


![-w879](media/14969698086369/14969919995983.jpg)

* `_id`是自动生成的主键id 

*![-w971](media/14969698086369/14969922367404.jpg)

![-w878](media/14969698086369/14969923137064.jpg)

****

### count语法
![-w690](media/14969698086369/14969924900588.jpg)

****

## 修改数据
### 有$set的修改
![-w639](media/14969698086369/14969927732775.jpg)


* `db.goods.save({'_id':ObjectId("593a4771c87cccd4618274dd"),name:'xiaomi6',price:2001})`

![-w698](media/14969698086369/14969932282779.jpg)

****

### 没有$set的修改
* 没有`$set` 没有设置数据的字段,就会被删除掉

****

## 删除数据 
* `db.collection.remove(查询条件)`


![-w525](media/14969698086369/14970087222747.jpg)


### 删除字段
* `db.collection.update({条件},{‘$unset’:{字段:1/字段:0}})	`

![-w792](media/14969698086369/14969936268930.jpg)

****

### 删除字段


**** 

## 使用php操作
### 安装 php-mongo扩展
## php操作
* 使用 mongo扩展中 MongoClient 类
* 安装php扩展并了解

![-w571](media/14969698086369/14969966754936.jpg)


****

### 添加数据

![-w468](media/14969698086369/14969957668920.jpg)


![-w652](media/14969698086369/14969957525312.jpg)

****

### 查找数据

![-w531](media/14969698086369/14969961338526.jpg)

****

### 更新数据

![-w434](media/14969698086369/14969963688431.jpg)


![-w547](media/14969698086369/14969963453731.jpg)

****

### 删除数据

![-w464](media/14969698086369/14969965756882.jpg)


![-w320](media/14969698086369/14969965565464.jpg)

****

## 账户权限
### 创建账户权限
* **① 先增加用户权限**
![-w516](media/14969698086369/14970088091830.jpg)

* **② 停止mongo服务,使用**
![-w816](media/14969698086369/14970147225267.jpg)

![-w702](media/14969698086369/14970150584715.jpg)

![-w437](media/14969698086369/14970151355181.jpg)

****

### php操作mongodb查看

![-w521](media/14969698086369/14970160730951.jpg)

****

## mongodb使用实列

* **① 文件获取数据存储到mongodb**

![-w522](media/14969698086369/14970161231421.jpg)

![](media/14969698086369/14970161457891.jpg)

* ② 从mysql里获取数据存储到mongodb

![](media/14969698086369/14971415719928.jpg)



