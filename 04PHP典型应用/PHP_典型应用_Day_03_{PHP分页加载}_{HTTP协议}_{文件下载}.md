# PHP_典型应用_Day_03_{PHP分页加载}_{HTTP协议}_{文件下载}

![PHP_典型应用_Day_03](media/14919584324397/PHP_%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8_Day_03.png)


[TOC]

##PHP分页原理
* 分页的SQL语句:`SELECT * FROM student LIMIT ` 开始的行号,每页显示多少记录
* 分页主要跟用户的单击有关,用户想看第几页,后面的数据 就根据当前页面进行数据处理

![屏幕快照 2017-04-12 下午09.43.58 上午-w1076](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8809.43.58%20%E4%B8%8A%E5%8D%88.png)


-------


## 分页的PHP代码

![屏幕快照 2017-04-12 下午19.27.17 下午-w639](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8819.27.17%20%E4%B8%8B%E5%8D%88.png)


###（1）连接数据库的公共代码 conn.php

```php

header("Content-type:text/html;charset=utf-8");

	$config = array(
		'db_host' =>  "localhost", 
		"db_user" => "root",
		"db_pass" => "12345",
		"db_name" => "itcast"
		);

	// PHP连接MySQL数据库
	
	$link = @mysql_connect($config['db_host'],$config["db_user"],$config["db_pass"]) or die("数据库连接失败");

	//选择数据库
	@mysql_select_db($config["db_name"]) or die("数据库选择失败");


	//设置字符集
	mysql_query("set names utf8");

	function dump($arr){
		echo "<pre>";
		print_r($arr);
		echo "</pre>";
	}

```

###（2）分页前的PHP代码

```php

header("Content-type:text/html;charset=utf-8");
	
  	require_once("./conn.php");
    //定义分页的参数
  	$pagessize = 1;
  	//获取当前页码 通过地址栏传递
  	if (empty($_GET["page_"])) {

  		$page = 1; 		// 默认1页
  		$startrow = 0;  // 默认开始行号为0

  	}else {
		$page = $_GET["page_"];
		if ($page <= 0) {
	  		$page = 1;
	  	}  		
  		
  		$startrow = ($page - 1) * $pagessize;
  	}
  	
  	//计算总记录数
  	$str = "SELECT * from student order by id";
  	$res = mysql_query($str);
  	$rescords = mysql_num_rows($res);
  	//计算总页数
  	$pages = ceil($rescords / $pagessize); 

  	//分页获取数据
  	$str = "SELECT * from student order by id LIMIT $startrow , $pagessize";
	$res = mysql_query($str);

```



```php


<?php 
	
		while ($row = mysql_fetch_array($res,MYSQL_ASSOC | MYSQL_NUM)) {
			
	 ?>
		<tr align = "center">	
			<td> <?php echo $row[0]; ?> </td>
			<td> <?php echo $row[1]; ?> </td>
			<td> <?php echo $row[2]; ?> </td>
			<td> <?php echo $row[3]; ?> </td>
			<td> <?php echo $row[4]; ?> </td>
			<td> <?php echo $row[5]; ?> </td>
			<td> <?php echo $row[6]; ?> </td>
			<td> <?php echo $row[7]; ?> </td>
			 
		</tr>
		<a href=""></a>
		
	<?php } ?>	

```


###   (3)   仿百度分页


```php

<tr align = "center">
		
			<td colspan = "8" class="list_page">
			<?php 

				$start = $page - 5;
				$end = $page + 4;
				
				

				if ($page < 6) {
					$start = 1;
					$end = 10;
				}

				if ($end > $pages) {
					$start = $pages-10+1;
					$end = $pages;	
				}

				if ($pages <= 10 ) {
					
					$start = 1;
					$end = $pages;

				}	
	
				//循环输出所有的页码
				//当前页
				for($i = $start; $i <= $end; $i++){
					if ($i == $page) {
						echo "<a class='page' href='?page = $i'> $i </a>";
					}else {
						echo "<a href='?page = $i'> $i </a>";
					}
					
				}

			 ?>
			 </td>
		</tr>

	</table>

```


## HTTP协议
### B/S网络结构
* B / S Brower / Server (浏览器 服务器) 将所有的共放在服务器上 客户端只需要一个浏览器软件即可
* C/S Client / Server 客户端 服务器

* 静态网页和动态网页:文件代码中 是否含有服务器端的脚本语言: 如 PHP JAVA 

-------


### HTTP协议概述 
* HTTP HyperText Transfer Protocol 超文本传输协议,是一种网络数据的传递标准
* HTTP是一种请求和响应的一种标准

-------


### HTTP协议特点
* 灵活: 可以发送任何类型的数据
* 无连接: 服务器每次只能处理一个请求.请求的结构返回后 连接就可以断开
* 无状态: HTTP协议本身没有记忆状态 

-------

##HTTP协议URL
* URL协议(Uniform Resource Locator) 统一资源定义器,对网络资源进行定位

-------

### URL的构成
* `协议: //主机名:端口号 /目录名 /文件名?参数 &参数 #锚点`
* `protocol://host:port/directory/filename.php?username=admin#top`
* `http://www.2017.cn/public/ab.php?user= name$pass=123456#top`
* protocol 网络协议: `ftp`,`http`,`email`,`news`,`telnet`
* host 代表资源的主机名: IP地址或者域名
* port 代表主机端口号
* directory 访问资源所有的目录名称
* filename.php 要访问的文件名
* ?name = value 通过地址栏传递到服务器的参数
* `#top` ,锚点跳转同一个页面不同部分

-------


## HTTP协议详解之请求

![屏幕快照 2017-04-12 下午18.40.04 下午-w590](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.40.04%20%E4%B8%8B%E5%8D%88.png)


-------


### HTTP请求构成
*  HTTP请求由三个部分构成：请求行、请求头信息、请求主体。
![屏幕快照 2017-04-12 下午18.41.48 下午-w605](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.41.48%20%E4%B8%8B%E5%8D%88.png)


-------


### 请求行格式
* 请求行的格式：请求方法  请求资源地址  HTTP协议版本
* 请求方法主要有两个：GET和POST

![屏幕快照 2017-04-12 下午18.42.59 下午-w300](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.42.59%20%E4%B8%8B%E5%8D%88.png)


-------

### GET和POST区别
#### GET请求方法：
* 发送的数据通过地址栏传过去
* 发送的数据类型，只能是字符串；
* 发送的数据量比较小。主要受限于浏览器地址栏的容量。
* 相对来说不太安全。
* 可以添加到收藏栏。


-------

#### POST请求
* POST数据是在HTTP协议的请求体中发送过来，不会在地址栏显示。
* POST可以发送所有类型的数据。主要指附件。
* POST发送的数据量没有限定。
* POST发送的数据相对安全。


-------

### 请求头信息含义和格式
* 请求头的含义:告诉浏览器,客户端的基本信息
![屏幕快照 2017-04-12 下午18.44.10 下午-w586](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.44.10%20%E4%B8%8B%E5%8D%88.png)

-------


### 请求主体
* GET方式是通过地址栏，向服务器发送数据，因此没有请求体。
* POST方式是将数据放在请求体中，发往服务器的。
![屏幕快照 2017-04-12 下午18.44.57 下午-w615](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.44.57%20%E4%B8%8B%E5%8D%88.png)


-------

### 带有附件的http请求头

![屏幕快照 2017-04-12 下午18.45.57 下午-w614](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.45.57%20%E4%B8%8B%E5%8D%88.png)


-------

#### 请问：在一个网页中有两张图片，共需要发送几次HTTP请求？

![屏幕快照 2017-04-12 下午18.46.49 下午-w511](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.46.49%20%E4%B8%8B%E5%8D%88.png)


-------

### 防盗链
#### Referer的概述
* 防止其他网站调用自己的资源,可以使用防盗链功能
* 外网调用本网站资源,客会流失,但是主机压力并没有减少
* referer: 可以获取访问当前网页的来源.从哪个网站跳转到当前网站的

-------


#### 使用`$_SERVER[]` 获取 HTTP请求的信息
* 每一次HTTP请求的所有信息,都会自动存储到 
* 每一次HTTP请求的所有信息，都会自动存储到超全局数组$_SERVER中。

![屏幕快照 2017-04-12 下午18.48.45 下午-w617](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.48.45%20%E4%B8%8B%E5%8D%88.png)

-------

#### 为什么并不是每一次HTTP请求都有Refrerer呢？
* 如果你在地址栏直接输入一个地址，不会有refrerer请求头。
* Refrerer请求头，必须是由链接跳转过来的，才会有。

![屏幕快照 2017-04-12 下午18.50.35 下午-w607](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.50.35%20%E4%B8%8B%E5%8D%88.png)

-------


#### 实现网页防盗链

![屏幕快照 2017-04-12 下午18.51.02 下午](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.51.02%20%E4%B8%8B%E5%8D%88.png)

![屏幕快照 2017-04-12 下午18.51.20 下午-w610](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.51.20%20%E4%B8%8B%E5%8D%88.png)


-------

## HTTP协议响应
#### 构成 
* 状态行,响应头,响应体

![屏幕快照 2017-04-12 下午18.52.01 下午-w436](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.52.01%20%E4%B8%8B%E5%8D%88.png)


-------

#### 状态行的格式:
* HTTP协议版本 状态码 状态码描述信息

-------

### 状态码的含义

![屏幕快照 2017-04-12 下午18.52.27 下午-w590](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.52.27%20%E4%B8%8B%E5%8D%88.png)


-------

#### 常用状态码

![屏幕快照 2017-04-12 下午18.52.53 下午-w542](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.52.53%20%E4%B8%8B%E5%8D%88.png)


-------

#### 302状态码演示(重定向)
![屏幕快照 2017-04-12 下午18.53.08 下午-w604](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.53.08%20%E4%B8%8B%E5%8D%88.png)

-------

#### 304状态码(内容没有改变)
* 网页图片会自动缓存 到本地
![屏幕快照 2017-04-12 下午18.53.40 下午-w610](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.53.40%20%E4%B8%8B%E5%8D%88.png)

-------


#### 404状态码演示(文件不存在)
![屏幕快照 2017-04-12 下午18.54.02 下午-w606](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.54.02%20%E4%B8%8B%E5%8D%88.png)

-------

#### 403资源找到 无权访问
![屏幕快照 2017-04-12 下午18.54.33 下午](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.54.33%20%E4%B8%8B%E5%8D%88.png)


-------

### 响应头的含义

![屏幕快照 2017-04-12 下午18.55.19 下午-w589](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.55.19%20%E4%B8%8B%E5%8D%88.png)

-------


#### 响应头Refresh(刷新并跳转)

![屏幕快照 2017-04-12 下午18.56.50 下午-w610](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.56.50%20%E4%B8%8B%E5%8D%88.png)


```php

header ("refresh:3;url=./a.html");
```


-------

#### 使用header函数禁用缓存
* 告知浏览器,有些数据不需要缓存

![屏幕快照 2017-04-12 下午18.57.19 下午-w608](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.57.19%20%E4%B8%8B%E5%8D%88.png)



```php
//禁用浏览器缓存,当前网页不用缓存
header("expires:-1");
header("pragma:no-cash");
header("cache-control:no-cache");

```

-------


### 文件下载

![屏幕快照 2017-04-12 下午18.58.01 下午-w548](media/14919584324397/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-12%20%E4%B8%8B%E5%8D%8818.58.01%20%E4%B8%8B%E5%8D%88.png)

-------


##附件

>  HTTP状态码对应表
 
![HTTP状态码详解](media/14919584324397/HTTP%E7%8A%B6%E6%80%81%E7%A0%81%E8%AF%A6%E8%A7%A3.png)



>  Content-type 对照表

![HTTP Content-type 对照表](media/14919584324397/HTTP%20Content-type%20%E5%AF%B9%E7%85%A7%E8%A1%A8.png)


